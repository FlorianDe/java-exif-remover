language: java
install: true

jdk:
- oraclejdk8

stages:
- build
- test
- deploy

before_install:
- chmod +x gradlew

before_script:
- export GRADLE_USER_HOME=`pwd`/.gradle

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/

build:
  stage: build
  script:
    - ./gradlew assemble
  artifacts:
    paths:
    - build/libs/*.jar
  only:
    - master

test:
  stage: test
  script:
    - ./gradlew check

deploy:
  provider: releases
  api_key:
    secure: "cpP8XGWrZ0xHPy9UyZ+oJ2XMRp/w0diJZfKLfiMDm99PZ502rrgVjtN/PNKwn/ZQaV3s+m863wkdFol+uxk6SfXWTdQsGnwI5RGJlGCCGq1ENZTKJ9VxYP7rQNzERXti6yUF0xNhNy1NrN2LWfe/96DqI2owhGWJA69kPXfEcdmmlM9NgYVPsIlmjcGFMWmCul6Bn6hY2KQue+UBYQfj6oiSt6LAIvQGnB0nf5feeUHP7J1a1VAqMKzG6+ub4wKlOB5eHgWXz96wSbEy/cxl6BXdUILxhgICkXR+mqbox0JDybw2XFfxpPaB+X+gbyDVm0/29YWsiiMcTnfhGUjPPzTzf8OK6SRmPH4X9OALjp1LD4zNE5gBp3hxt0Bdc3gWKY5Bi87EeQa+OIclI2hGKLx0BJp2w0+s1k7WZJFVKcyy3YgpSu6mbaufojcV3Bb/xotesD+8VzIXGO2/OJCBOA5bqP+tzVkdfWqEPYL1KDKA0dX1q2VaSqSDGwYE0M4bwDxcB4HZqUs8nfbD3RCCcboe2cNy1KQpM2oqfcIH0U3/l6zTX2LbzZt/4nAcIe628RRm40V5jA6q3lALvcATfStrJwRPeydPDxDr9+t5f7TsLMRG/sHLYFiK1TztECW7kWPauENvnZYdGJ3eoF3z5pOTbhWntyNTI/ZOlcvjBI4="
  file:
    - "build/libs/*.jar"
  skip_cleanup: true
  on:
    tags: true